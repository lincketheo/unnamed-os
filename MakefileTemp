CROSS_COMPILE_ROOT=~/opt/cross

# GCC
CC=$(CROSS_COMPILE_ROOT)/bin/i686-elf-gcc
INC=./include
CFLAGS=-ffreestanding -m32 -g -c -I$(INC)

# LD
LD=$(CROSS_COMPILE_ROOT)/bin/i686-elf-ld

# Assembly
ASM=nasm

CSRC=$(shell find ./ -name "*.c")
COBJ=$(patsubst %.c,%.o,$(CSRC))

ASMSRC=./bootloader/boot.asm \
	   ./kernel/kernel_entry.asm
ASMOBJ=$(patsubst %.asm,%.o,$(ASMSRC))

BUILD=./build

all: $(BUILD) $(BUILD)/os.bin

$(BUILD)/os.bin: $(BUILD)/boot.bin $(BUILD)/kernel.bin
	cat $^ > $@

$(BUILD)/kernel.bin: $(BUILD)/kernel_entry.o $(BUILD)/kernel.o
	$(LD) -o $@ -Ttext 0x1000 $^ --oformat binary 

$(BUILD)/kernel_entry.o: ./kernel/kernel_entry.asm
	$(ASM) $^ -f elf -o $@


.PHONY: clean

clean:
	rm -rf $(BUILD)
